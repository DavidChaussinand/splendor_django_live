{% extends 'jeu_templates/base.html' %}
{% load static %}

{% block title %}Partie : {{ nom_partie }}{% endblock %}

{% block content %}
    <link rel="stylesheet" type="text/css" href="{% static 'css/style.css' %}">

    <h2 class="display-4">Partie : {{ nom_partie }}</h2>
    <p class="lead">Préparez-vous à jouer !</p>
    <p>Partie ID : {{ partie.id }}</p>
    <p>Reset game URL : {% url 'reset_game' partie.id %}</p>

    <p id="current_player">C'est au tour de : {{ current_player.username }}</p>

    <div id="message-container"></div>
    
    <!-- Bouton de réinitialisation de la partie -->
    
    <button id="reset-game" data-url="{% url 'reset_game' partie.id %}">Réinitialiser la partie</button>
    
  



    <!-- Affichage du nombre de joueurs -->
    <div>
        <h3>Nombre de joueurs : {{ partie.joueurs.count }} / {{ partie.nombre_joueurs }}</h3>
    </div>


    <div class="plateau">
        <div class="jetons">
            {% for couleur, quantite in plateau.items %}
                <div id="plateau-{{ couleur }}-quantite" class="jeton {{ couleur }}" data-color="{{ couleur }}">
                    {{ couleur }}: <span>{{ quantite }}</span>
                </div>
            {% endfor %}
        </div>
        <button id="prendre-deux-jetons">Prendre 2 jetons de la couleur sélectionnée</button>
        <button id="prendre-trois-jetons">Prendre 3 jetons différents</button>
        <div class="clear"></div>
        <!-- Affichage des cartes du plateau -->
        <div class="cartes-plateau row">
            {% for carte in cartes_plateau %}
                <div class="col-md-3 mb-4">
                    <div class="carte card h-100">
                        <img src="{% static carte.image_path %}" class="card-img-top" alt="Image de la carte">
                        <div class="card-body">
                            <h5 class="card-title">Niveau {{ carte.niveau }}</h5>
                            <h5 class="card-title">id {{ carte.id }}</h5>
                            <p class="card-text">
                                <strong>Bonus :</strong> {{ carte.bonus|capfirst }}<br>
                                <strong>Points de victoire :</strong> {{ carte.points_victoire }}
                            </p>
                            <p class="card-text"><strong>Coût :</strong></p>
                            <ul class="list-unstyled">
                                {% for couleur, quantite in carte.get_cout.items %}
                                    <li>{{ couleur|capfirst }} : {{ quantite }}</li>
                                {% endfor %}
                            </ul>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    </div>

    <!-- Informations des joueurs -->
    <div class="joueur">
        <h2>{{ joueur_courant.joueur.username }} (Vous)</h2>
        <p>Points de victoire : {{ joueur_courant.points_victoire }}</p>
        <h3>Vos jetons :</h3>
        <ul>
            {% for couleur, quantite in joueur_courant.jetons.items %}
                <li id="joueur-jetons-{{ joueur_courant.joueur.username }}-{{ couleur }}">{{ couleur }} : <span>{{ quantite }}</span></li>
            {% endfor %}
        </ul>
    </div>
    
    {% for adversaire in adversaires %}
    <div class="joueur">
        <h2>{{ adversaire.joueur.username }}</h2>
        <p>Points de victoire : {{ adversaire.points_victoire }}</p>
        <h3>Ses jetons :</h3>
        <ul>
            {% for couleur, quantite in adversaire.jetons.items %}
                <li id="joueur-jetons-{{ adversaire.joueur.username }}-{{ couleur }}">{{ couleur }} : <span>{{ quantite }}</span></li>
            {% endfor %}
        </ul>
    </div>
    {% endfor %}
    
{% endblock %}

{% block scripts %}
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>
    <script type="module" src="{% static 'js/reset_game.js' %}"></script>
    <script>
        const nom_partie = "{{ nom_partie|escapejs }}";
        const monNomUtilisateur = "{{ request.user.username|escapejs }}";
        const currentPlayer = "{{ current_player.username|escapejs }}";
    </script>
    <script type="module" src="{% static 'js/main.js' %}"></script>

{% endblock %}
